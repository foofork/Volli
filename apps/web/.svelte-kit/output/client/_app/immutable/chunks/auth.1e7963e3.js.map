{"version":3,"file":"auth.1e7963e3.js","sources":["../../../../../../src/lib/stores/auth.ts"],"sourcesContent":["import { writable, derived } from 'svelte/store';\n\n// Local type definitions to avoid cross-package imports\ninterface Identity {\n\tid: string;\n\tpublicKey: Uint8Array;\n\tdevices: Device[];\n\tcreatedAt: Date;\n\trecoveryKey: Uint8Array;\n}\n\ninterface Device {\n\tid: string;\n\tname: string;\n\tpublicKey: Uint8Array;\n\ttype: 'primary' | 'secondary';\n\tplatform: string;\n\tlastSeen: Date;\n\tcapabilities: string[];\n}\n\ninterface AuthState {\n\tidentity: Identity | null;\n\tdevice: Device | null;\n\tisAuthenticated: boolean;\n\tisLoading: boolean;\n\terror: string | null;\n}\n\nfunction createAuthStore() {\n\tconst { subscribe, set, update } = writable<AuthState>({\n\t\tidentity: null,\n\t\tdevice: null,\n\t\tisAuthenticated: false,\n\t\tisLoading: false,\n\t\terror: null\n\t});\n\n\tasync function initialize() {\n\t\tupdate(state => ({ ...state, isLoading: true, error: null }));\n\t\t\n\t\ttry {\n\t\t\t// Check for existing identity in localStorage\n\t\t\tconst storedIdentity = localStorage.getItem('volli_identity');\n\t\t\tif (storedIdentity) {\n\t\t\t\tconst identity = JSON.parse(storedIdentity);\n\t\t\t\tupdate(state => ({\n\t\t\t\t\t...state,\n\t\t\t\t\tidentity,\n\t\t\t\t\tisAuthenticated: true,\n\t\t\t\t\tisLoading: false\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tupdate(state => ({ ...state, isLoading: false }));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tupdate(state => ({\n\t\t\t\t...state,\n\t\t\t\tisLoading: false,\n\t\t\t\terror: error instanceof Error ? error.message : 'Failed to initialize'\n\t\t\t}));\n\t\t}\n\t}\n\n\tasync function createIdentity(displayName: string) {\n\t\tupdate(state => ({ ...state, isLoading: true, error: null }));\n\t\t\n\t\ttry {\n\t\t\t// Create mock identity for now (will use real @volli/identity-core later)\n\t\t\tconst identity: Identity = {\n\t\t\t\tid: crypto.randomUUID(),\n\t\t\t\tpublicKey: new Uint8Array(32),\n\t\t\t\tdevices: [],\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t\trecoveryKey: new Uint8Array(32)\n\t\t\t};\n\t\t\t\n\t\t\tconst device: Device = {\n\t\t\t\tid: crypto.randomUUID(),\n\t\t\t\tname: displayName,\n\t\t\t\tpublicKey: new Uint8Array(32),\n\t\t\t\ttype: 'primary',\n\t\t\t\tplatform: 'web',\n\t\t\t\tlastSeen: new Date(),\n\t\t\t\tcapabilities: ['messaging', 'storage']\n\t\t\t};\n\t\t\t\n\t\t\t// Store in localStorage\n\t\t\tlocalStorage.setItem('volli_identity', JSON.stringify(identity));\n\t\t\tlocalStorage.setItem('volli_device', JSON.stringify(device));\n\t\t\t\n\t\t\tupdate(state => ({\n\t\t\t\t...state,\n\t\t\t\tidentity,\n\t\t\t\tdevice,\n\t\t\t\tisAuthenticated: true,\n\t\t\t\tisLoading: false\n\t\t\t}));\n\t\t} catch (error) {\n\t\t\tupdate(state => ({\n\t\t\t\t...state,\n\t\t\t\tisLoading: false,\n\t\t\t\terror: error instanceof Error ? error.message : 'Failed to create identity'\n\t\t\t}));\n\t\t}\n\t}\n\n\tasync function logout() {\n\t\tlocalStorage.removeItem('volli_identity');\n\t\tlocalStorage.removeItem('volli_device');\n\t\tlocalStorage.removeItem('volli_vault_key');\n\t\t\n\t\tset({\n\t\t\tidentity: null,\n\t\t\tdevice: null,\n\t\t\tisAuthenticated: false,\n\t\t\tisLoading: false,\n\t\t\terror: null\n\t\t});\n\t}\n\n\treturn {\n\t\tsubscribe,\n\t\tinitialize,\n\t\tcreateIdentity,\n\t\tlogout\n\t};\n}\n\nexport const auth = createAuthStore();\nexport const isAuthenticated = derived(auth, $auth => $auth.isAuthenticated);"],"names":["createAuthStore","subscribe","set","update","writable","initialize","state","storedIdentity","identity","error","createIdentity","displayName","device","logout","auth","isAuthenticated","derived","$auth"],"mappings":"0CA6BA,SAASA,GAAkB,CAC1B,KAAM,CAAE,UAAAC,EAAW,IAAAC,EAAK,OAAAC,CAAA,EAAWC,EAAoB,CACtD,SAAU,KACV,OAAQ,KACR,gBAAiB,GACjB,UAAW,GACX,MAAO,IAAA,CACP,EAED,eAAeC,GAAa,CACpBF,EAAAG,IAAU,CAAE,GAAGA,EAAO,UAAW,GAAM,MAAO,IAAO,EAAA,EAExD,GAAA,CAEG,MAAAC,EAAiB,aAAa,QAAQ,gBAAgB,EAC5D,GAAIA,EAAgB,CACb,MAAAC,EAAW,KAAK,MAAMD,CAAc,EAC1CJ,EAAiBG,IAAA,CAChB,GAAGA,EACH,SAAAE,EACA,gBAAiB,GACjB,UAAW,EACV,EAAA,CAAA,MAEFL,MAAiB,CAAE,GAAGG,EAAO,UAAW,EAAQ,EAAA,QAEzCG,EAAO,CACfN,EAAiBG,IAAA,CAChB,GAAGA,EACH,UAAW,GACX,MAAOG,aAAiB,MAAQA,EAAM,QAAU,sBAC/C,EAAA,CACH,CACD,CAEA,eAAeC,EAAeC,EAAqB,CAC3CR,EAAAG,IAAU,CAAE,GAAGA,EAAO,UAAW,GAAM,MAAO,IAAO,EAAA,EAExD,GAAA,CAEH,MAAME,EAAqB,CAC1B,GAAI,OAAO,WAAW,EACtB,UAAW,IAAI,WAAW,EAAE,EAC5B,QAAS,CAAC,EACV,cAAe,KACf,YAAa,IAAI,WAAW,EAAE,CAAA,EAGzBI,EAAiB,CACtB,GAAI,OAAO,WAAW,EACtB,KAAMD,EACN,UAAW,IAAI,WAAW,EAAE,EAC5B,KAAM,UACN,SAAU,MACV,aAAc,KACd,aAAc,CAAC,YAAa,SAAS,CAAA,EAItC,aAAa,QAAQ,iBAAkB,KAAK,UAAUH,CAAQ,CAAC,EAC/D,aAAa,QAAQ,eAAgB,KAAK,UAAUI,CAAM,CAAC,EAE3DT,EAAiBG,IAAA,CAChB,GAAGA,EACH,SAAAE,EACA,OAAAI,EACA,gBAAiB,GACjB,UAAW,EACV,EAAA,QACMH,EAAO,CACfN,EAAiBG,IAAA,CAChB,GAAGA,EACH,UAAW,GACX,MAAOG,aAAiB,MAAQA,EAAM,QAAU,2BAC/C,EAAA,CACH,CACD,CAEA,eAAeI,GAAS,CACvB,aAAa,WAAW,gBAAgB,EACxC,aAAa,WAAW,cAAc,EACtC,aAAa,WAAW,iBAAiB,EAErCX,EAAA,CACH,SAAU,KACV,OAAQ,KACR,gBAAiB,GACjB,UAAW,GACX,MAAO,IAAA,CACP,CACF,CAEO,MAAA,CACN,UAAAD,EACA,WAAAI,EACA,eAAAK,EACA,OAAAG,CAAA,CAEF,CAEO,MAAMC,EAAOd,EAAgB,EACvBe,EAAkBC,EAAQF,EAAMG,GAASA,EAAM,eAAe"}