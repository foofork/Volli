{"version":3,"file":"_page.svelte.js","sources":["../../../../../../src/routes/app/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { vault } from '$lib/stores/vault';\n\timport { messages, activeConversation, activeMessages } from '$lib/stores/messages';\n\t\n\tlet messageInput = '';\n\tlet isUnlocking = false;\n\tlet passphrase = '';\n\tlet unlockError = '';\n\t\n\tonMount(() => {\n\t\t// Load conversations if vault is unlocked\n\t\tif ($vault.isUnlocked) {\n\t\t\tmessages.loadConversations();\n\t\t}\n\t});\n\t\n\tasync function handleUnlock() {\n\t\tif (!passphrase) {\n\t\t\tunlockError = 'Please enter a passphrase';\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tisUnlocking = true;\n\t\tunlockError = '';\n\t\t\n\t\ttry {\n\t\t\tawait vault.unlock(passphrase);\n\t\t\tawait messages.loadConversations();\n\t\t\tpassphrase = '';\n\t\t} catch (err) {\n\t\t\tunlockError = err instanceof Error ? err.message : 'Failed to unlock vault';\n\t\t} finally {\n\t\t\tisUnlocking = false;\n\t\t}\n\t}\n\t\n\tasync function handleSendMessage() {\n\t\tif (!messageInput.trim() || !$activeConversation) return;\n\t\t\n\t\tconst content = {\n\t\t\ttype: 'text',\n\t\t\ttext: messageInput.trim()\n\t\t};\n\t\t\n\t\tawait messages.sendMessage($activeConversation.id, content);\n\t\tmessageInput = '';\n\t}\n\t\n\tasync function createDemoConversation() {\n\t\tconst id = await messages.createConversation(['demo-user'], 'Demo Chat');\n\t\tmessages.setActiveConversation(id);\n\t}\n\t\n\tfunction selectConversation(id) {\n\t\tmessages.setActiveConversation(id);\n\t}\n\t\n\tfunction formatTime(date) {\n\t\treturn new Intl.DateTimeFormat('en-US', {\n\t\t\thour: 'numeric',\n\t\t\tminute: 'numeric',\n\t\t\thour12: true\n\t\t}).format(date);\n\t}\n</script>\n\n<div class=\"messages-layout\">\n\t{#if !$vault.isUnlocked}\n\t\t<div class=\"unlock-container\">\n\t\t\t<div class=\"unlock-card\">\n\t\t\t\t<h2>üîê Unlock Your Vault</h2>\n\t\t\t\t<p>Enter your passphrase to decrypt your messages</p>\n\t\t\t\t\n\t\t\t\t<form on:submit|preventDefault={handleUnlock}>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tbind:value={passphrase}\n\t\t\t\t\t\tplaceholder=\"Enter passphrase\"\n\t\t\t\t\t\tdisabled={isUnlocking}\n\t\t\t\t\t/>\n\t\t\t\t\t\n\t\t\t\t\t{#if unlockError}\n\t\t\t\t\t\t<div class=\"error\">{unlockError}</div>\n\t\t\t\t\t{/if}\n\t\t\t\t\t\n\t\t\t\t\t<button type=\"submit\" disabled={isUnlocking}>\n\t\t\t\t\t\t{isUnlocking ? 'Unlocking...' : 'Unlock'}\n\t\t\t\t\t</button>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t{:else}\n\t\t<div class=\"conversation-list\">\n\t\t\t<div class=\"list-header\">\n\t\t\t\t<h2>Messages</h2>\n\t\t\t\t<button class=\"new-chat\" on:click={createDemoConversation}>\n\t\t\t\t\t+ New Chat\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class=\"conversations\">\n\t\t\t\t{#if $messages.conversations.size === 0}\n\t\t\t\t\t<div class=\"empty-state\">\n\t\t\t\t\t\t<p>No conversations yet</p>\n\t\t\t\t\t\t<button on:click={createDemoConversation}>Start a conversation</button>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t{#each [...$messages.conversations.values()] as conversation}\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"conversation-item\"\n\t\t\t\t\t\t\tclass:active={$activeConversation?.id === conversation.id}\n\t\t\t\t\t\t\ton:click={() => selectConversation(conversation.id)}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class=\"conversation-avatar\">üí¨</div>\n\t\t\t\t\t\t\t<div class=\"conversation-details\">\n\t\t\t\t\t\t\t\t<div class=\"conversation-name\">{conversation.metadata.name}</div>\n\t\t\t\t\t\t\t\t<div class=\"conversation-preview\">\n\t\t\t\t\t\t\t\t\t{conversation.lastMessage ? conversation.lastMessage.content.text : 'No messages yet'}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{#if conversation.updatedAt}\n\t\t\t\t\t\t\t\t<div class=\"conversation-time\">\n\t\t\t\t\t\t\t\t\t{formatTime(conversation.updatedAt)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t{/each}\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t\t\n\t\t<div class=\"chat-view\">\n\t\t\t{#if $activeConversation}\n\t\t\t\t<div class=\"chat-header\">\n\t\t\t\t\t<h3>{$activeConversation.metadata.name}</h3>\n\t\t\t\t\t<div class=\"chat-actions\">\n\t\t\t\t\t\t<button class=\"icon-button\" title=\"Call\">üìû</button>\n\t\t\t\t\t\t<button class=\"icon-button\" title=\"Info\">‚ÑπÔ∏è</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div class=\"messages-container\">\n\t\t\t\t\t{#if $activeMessages.length === 0}\n\t\t\t\t\t\t<div class=\"empty-chat\">\n\t\t\t\t\t\t\t<p>üîí Messages are end-to-end encrypted</p>\n\t\t\t\t\t\t\t<p>Start a conversation</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t{#each $activeMessages as message}\n\t\t\t\t\t\t\t<div class=\"message\" class:sent={message.senderId === 'current-user'}>\n\t\t\t\t\t\t\t\t<div class=\"message-bubble\">\n\t\t\t\t\t\t\t\t\t{message.content.text}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"message-time\">\n\t\t\t\t\t\t\t\t\t{formatTime(message.timestamp)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<form class=\"message-input\" on:submit|preventDefault={handleSendMessage}>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tbind:value={messageInput}\n\t\t\t\t\t\tplaceholder=\"Type a secure message...\"\n\t\t\t\t\t/>\n\t\t\t\t\t<button type=\"submit\" disabled={!messageInput.trim()}>\n\t\t\t\t\t\tSend\n\t\t\t\t\t</button>\n\t\t\t\t</form>\n\t\t\t{:else}\n\t\t\t\t<div class=\"no-conversation\">\n\t\t\t\t\t<h2>Select a conversation</h2>\n\t\t\t\t\t<p>Choose a conversation from the list or start a new one</p>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n</div>\n\n<style>\n\t.messages-layout {\n\t\tdisplay: flex;\n\t\theight: 100%;\n\t\tbackground: #0a0a0a;\n\t}\n\t\n\t/* Unlock Screen */\n\t.unlock-container {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tpadding: 2rem;\n\t}\n\t\n\t.unlock-card {\n\t\twidth: 100%;\n\t\tmax-width: 400px;\n\t\tbackground: rgba(255, 255, 255, 0.05);\n\t\tborder: 1px solid rgba(255, 255, 255, 0.1);\n\t\tborder-radius: 16px;\n\t\tpadding: 2rem;\n\t}\n\t\n\t.unlock-card h2 {\n\t\tmargin: 0 0 0.5rem;\n\t\tcolor: #fff;\n\t}\n\t\n\t.unlock-card p {\n\t\tcolor: #888;\n\t\tmargin-bottom: 2rem;\n\t}\n\t\n\t.unlock-card input {\n\t\twidth: 100%;\n\t\tpadding: 0.75rem;\n\t\tbackground: rgba(255, 255, 255, 0.05);\n\t\tborder: 1px solid rgba(255, 255, 255, 0.1);\n\t\tborder-radius: 8px;\n\t\tcolor: #fff;\n\t\tmargin-bottom: 1rem;\n\t}\n\t\n\t.unlock-card button {\n\t\twidth: 100%;\n\t\tpadding: 0.75rem;\n\t\tbackground: #3B82F6;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\ttransition: all 0.3s ease;\n\t}\n\t\n\t.unlock-card button:hover:not(:disabled) {\n\t\tbackground: #2563EB;\n\t}\n\t\n\t.unlock-card button:disabled {\n\t\topacity: 0.7;\n\t\tcursor: not-allowed;\n\t}\n\t\n\t.error {\n\t\tbackground: rgba(239, 68, 68, 0.1);\n\t\tborder: 1px solid rgba(239, 68, 68, 0.3);\n\t\tcolor: #EF4444;\n\t\tpadding: 0.5rem;\n\t\tborder-radius: 6px;\n\t\tmargin-bottom: 1rem;\n\t\tfont-size: 0.9rem;\n\t}\n\t\n\t/* Conversation List */\n\t.conversation-list {\n\t\twidth: 320px;\n\t\tborder-right: 1px solid rgba(255, 255, 255, 0.1);\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t\n\t.list-header {\n\t\tpadding: 1.5rem;\n\t\tborder-bottom: 1px solid rgba(255, 255, 255, 0.1);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t}\n\t\n\t.list-header h2 {\n\t\tmargin: 0;\n\t\tfont-size: 1.25rem;\n\t\tcolor: #fff;\n\t}\n\t\n\t.new-chat {\n\t\tpadding: 0.5rem 1rem;\n\t\tbackground: #3B82F6;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 6px;\n\t\tfont-size: 0.9rem;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\ttransition: all 0.3s ease;\n\t}\n\t\n\t.new-chat:hover {\n\t\tbackground: #2563EB;\n\t}\n\t\n\t.conversations {\n\t\tflex: 1;\n\t\toverflow-y: auto;\n\t}\n\t\n\t.empty-state {\n\t\ttext-align: center;\n\t\tpadding: 3rem 1.5rem;\n\t\tcolor: #666;\n\t}\n\t\n\t.empty-state button {\n\t\tmargin-top: 1rem;\n\t\tpadding: 0.5rem 1rem;\n\t\tbackground: rgba(59, 130, 246, 0.1);\n\t\tcolor: #3B82F6;\n\t\tborder: 1px solid #3B82F6;\n\t\tborder-radius: 6px;\n\t\tcursor: pointer;\n\t\ttransition: all 0.3s ease;\n\t}\n\t\n\t.empty-state button:hover {\n\t\tbackground: rgba(59, 130, 246, 0.2);\n\t}\n\t\n\t.conversation-item {\n\t\twidth: 100%;\n\t\tpadding: 1rem 1.5rem;\n\t\tbackground: transparent;\n\t\tborder: none;\n\t\tborder-bottom: 1px solid rgba(255, 255, 255, 0.05);\n\t\tcursor: pointer;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 0.75rem;\n\t\ttext-align: left;\n\t\ttransition: all 0.3s ease;\n\t\tcolor: #fff;\n\t}\n\t\n\t.conversation-item:hover {\n\t\tbackground: rgba(255, 255, 255, 0.05);\n\t}\n\t\n\t.conversation-item.active {\n\t\tbackground: rgba(59, 130, 246, 0.1);\n\t}\n\t\n\t.conversation-avatar {\n\t\twidth: 48px;\n\t\theight: 48px;\n\t\tborder-radius: 50%;\n\t\tbackground: rgba(255, 255, 255, 0.1);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tfont-size: 1.5rem;\n\t}\n\t\n\t.conversation-details {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t}\n\t\n\t.conversation-name {\n\t\tfont-weight: 600;\n\t\tmargin-bottom: 0.25rem;\n\t}\n\t\n\t.conversation-preview {\n\t\tfont-size: 0.9rem;\n\t\tcolor: #888;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t}\n\t\n\t.conversation-time {\n\t\tfont-size: 0.8rem;\n\t\tcolor: #666;\n\t}\n\t\n\t/* Chat View */\n\t.chat-view {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t\n\t.chat-header {\n\t\tpadding: 1rem 1.5rem;\n\t\tborder-bottom: 1px solid rgba(255, 255, 255, 0.1);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\tbackground: rgba(255, 255, 255, 0.02);\n\t}\n\t\n\t.chat-header h3 {\n\t\tmargin: 0;\n\t\tfont-size: 1.1rem;\n\t\tcolor: #fff;\n\t}\n\t\n\t.chat-actions {\n\t\tdisplay: flex;\n\t\tgap: 0.5rem;\n\t}\n\t\n\t.messages-container {\n\t\tflex: 1;\n\t\toverflow-y: auto;\n\t\tpadding: 1.5rem;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tgap: 1rem;\n\t}\n\t\n\t.empty-chat {\n\t\ttext-align: center;\n\t\tmargin: auto;\n\t\tcolor: #666;\n\t}\n\t\n\t.empty-chat p:first-child {\n\t\tfont-size: 1.1rem;\n\t\tmargin-bottom: 0.5rem;\n\t}\n\t\n\t.message {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tmax-width: 70%;\n\t}\n\t\n\t.message.sent {\n\t\talign-self: flex-end;\n\t\talign-items: flex-end;\n\t}\n\t\n\t.message-bubble {\n\t\tpadding: 0.75rem 1rem;\n\t\tborder-radius: 12px;\n\t\tbackground: rgba(255, 255, 255, 0.1);\n\t\tcolor: #fff;\n\t\tword-wrap: break-word;\n\t}\n\t\n\t.message.sent .message-bubble {\n\t\tbackground: #3B82F6;\n\t}\n\t\n\t.message-time {\n\t\tfont-size: 0.75rem;\n\t\tcolor: #666;\n\t\tmargin-top: 0.25rem;\n\t\tpadding: 0 0.5rem;\n\t}\n\t\n\t.message-input {\n\t\tpadding: 1rem 1.5rem;\n\t\tborder-top: 1px solid rgba(255, 255, 255, 0.1);\n\t\tdisplay: flex;\n\t\tgap: 1rem;\n\t\tbackground: rgba(255, 255, 255, 0.02);\n\t}\n\t\n\t.message-input input {\n\t\tflex: 1;\n\t\tpadding: 0.75rem 1rem;\n\t\tbackground: rgba(255, 255, 255, 0.05);\n\t\tborder: 1px solid rgba(255, 255, 255, 0.1);\n\t\tborder-radius: 8px;\n\t\tcolor: #fff;\n\t\tfont-size: 1rem;\n\t}\n\t\n\t.message-input input:focus {\n\t\toutline: none;\n\t\tborder-color: #3B82F6;\n\t\tbackground: rgba(255, 255, 255, 0.08);\n\t}\n\t\n\t.message-input button {\n\t\tpadding: 0.75rem 1.5rem;\n\t\tbackground: #3B82F6;\n\t\tcolor: white;\n\t\tborder: none;\n\t\tborder-radius: 8px;\n\t\tfont-weight: 600;\n\t\tcursor: pointer;\n\t\ttransition: all 0.3s ease;\n\t}\n\t\n\t.message-input button:hover:not(:disabled) {\n\t\tbackground: #2563EB;\n\t}\n\t\n\t.message-input button:disabled {\n\t\topacity: 0.5;\n\t\tcursor: not-allowed;\n\t}\n\t\n\t.no-conversation {\n\t\tflex: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tcolor: #666;\n\t\ttext-align: center;\n\t\tpadding: 2rem;\n\t}\n\t\n\t.no-conversation h2 {\n\t\tmargin: 0 0 0.5rem;\n\t\tcolor: #888;\n\t}\n\t\n\t@media (max-width: 768px) {\n\t\t.conversation-list {\n\t\t\tdisplay: none;\n\t\t}\n\t}\n</style>"],"names":[],"mappings":";;;;;;;AA0DU,SAAA,WAAW,MAAI;aACZ,KAAK;AAAA,IAAe;AAAA;MAC9B,MAAM;AAAA,MACN,QAAQ;AAAA,MACR,QAAQ;AAAA,IACN;AAAA,EAAA,EAAA,OAAO,IAAI;;;;;;;;;;;AA1DX,MAAA,eAAe;AAEf,MAAA,aAAa;;;;;;AA6DX,SAAA,8CAAA,CAAA,OAAO,2VAWa,EAAA,yBAAA,cAAA,SAFT,YAAU,CAAA,CAAA,KASS,EAAA,0BAC9B,EAAA,0BAAA,OAA+B,QAAQ,CAAA,iCAerC,sSAAA,UAAU,cAAc,SAAS,sNAM1B,UAAU,cAAc,OAAM,CAAA,GAAA,kBAAA;;;MAGzB,qBAAqB,OAAO,aAAa;IAKtB,EAAA,KAAA,GAAA,EAAA,KAAA,CAAA,wLAAA,OAAA,aAAa,SAAS,IAAI,CAExD,0DAAA,OAAA,aAAa,cAAc,aAAa,YAAY,QAAQ,OAAO,iBAAiB,CAAA,iBAGlF,aAAa,mEAEf,WAAW,aAAa,SAAS,CAAA,CAAA;2DAUnC,iGAEE,oBAAoB,SAAS,IAAI,oPAQjC,gBAAgB,WAAW,+MAMxB,iBAAe,aAAA;;;MACY,QAAQ,aAAa,iBAAc,SAAA;AAAA,4EAEjE,QAAQ,QAAQ,IAAI,0DAGpB,WAAW,QAAQ,SAAS,CAAA,CAAA;AAAA,gKAUpB,cAAY,CAAA,CAAA,2BAAA,CAGQ,aAAa,KAAI,IAAA,aAAA,EAAA;;"}